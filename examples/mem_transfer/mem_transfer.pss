
graph mem_transfer(dma_if dma, mem_mgr_if mem) {
	rand dma_descriptor desc;
	int dma_avail, channel;
	
	mem_transfer(addr_t src, addr_t dst, size_t sz) := {
		dma.is_avail(dma_avail);
		
		select {
			if (dma_avail == 1) {
				dma.acquire_channel(channel);
				desc with { 
					desc.addr_src == src; 
					desc.addr_dst == dst; 
					desc.tot_sz == sz;
				};
				dma.do_transfer(channel, desc);
			}
			
			mem.memcpy(dst, src, sz);
		}
	}
}